<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABI Fish & Pets - Full Fix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        :root { --primary: #00ff88; --bg: #050505; --card: #121212; --glass: rgba(255, 255, 255, 0.05); }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: #fff; overflow-x: hidden; }
        .hidden { display: none !important; }
  #priority-sec { 
        padding: 15px 0; 
        background: #000; 
    }

    .swipe-container { 
        display: flex; 
        gap: 15px; 
        overflow-x: auto; /* Horizontal scroll enable gareko */
        padding: 0 20px 20px; 
        scrollbar-width: none; /* Firefox ko lagi scrollbar hide */
        -webkit-overflow-scrolling: touch; /* Mobile ma smooth scroll ko lagi */
    }

    /* Chrome, Safari ko lagi scrollbar hide gareko */
    .swipe-container::-webkit-scrollbar { 
        display: none; 
    }
    
    .slide-card { 
        min-width: 200px; /* Card ko size fixed gareko jasle garda side by side bascha */
        max-width: 200px; 
        background: var(--card); 
        border-radius: 20px; 
        border: 1.5px solid var(--primary); 
        overflow: hidden; 
        flex-shrink: 0; /* Card lai shrink huna nadiya ko, scroll huna help garcha */
    }

    .slide-img { 
        width: 100%; 
        height: 120px; 
        object-fit: cover; 
    }

        /* AUTH SECTIONS */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { width: 100%; max-width: 380px; background: var(--card); padding: 30px; border-radius: 25px; border: 1px solid var(--glass); text-align: center; }
        .auth-box input { width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 12px; border: 1px solid #333; background: #1a1a1a; color: #fff; outline: none; }
        .primary-btn { width: 100%; padding: 14px; background: var(--primary); border: none; border-radius: 12px; font-weight: 800; cursor: pointer; color: #000; }

        /* HERO SECTION */
        .hero { height: 220px; position: relative; display: flex; align-items: center; justify-content: center; text-align: center; overflow: hidden; border-radius: 0 0 30px 30px; margin-bottom: 20px; }
        .hero-img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0.4; z-index: -1; }
        .hero-content h1 { font-size: 28px; font-weight: 800; color: var(--primary); }

        /* SEARCH BAR */
        .search-container { padding: 10px 20px; }
        .search-box { display: flex; background: var(--card); border-radius: 15px; border: 1px solid #333; overflow: hidden; }
        .search-box input { flex: 1; padding: 12px; border: none; background: none; color: #fff; outline: none; }
        .search-box button { padding: 0 15px; background: var(--primary); border: none; color: #000; font-weight: 800; }

        /* CATEGORIES */
        .cat-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px; scrollbar-width: none; }
        .cat-chip { padding: 8px 18px; background: var(--card); border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; border: 1px solid #333; cursor: pointer; }
        .cat-chip.active { background: var(--primary); color: #000; border-color: var(--primary); }

        /* GRID & CARDS */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .item-card { background: var(--card); border-radius: 24px; overflow: hidden; border: 1px solid var(--glass); position: relative; }
        .item-img { width: 100%; height: 150px; object-fit: cover; }
        .price-tag { background: var(--primary); color: #000; padding: 4px 10px; border-radius: 8px; font-weight: 800; font-size: 12px; display: inline-block; margin: 10px; }

        /* FOOTER */
        footer { background: #000; padding: 40px 20px; text-align: center; border-top: 1px solid #222; margin-top: 30px; }
        
        /* MODAL */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .fab { position: fixed; bottom: 30px; right: 25px; background: var(--primary); width: 60px; height: 60px; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #000; border: none; z-index: 1001; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div id="reg-box" class="auth-box">
        <h2 style="color:var(--primary); margin-bottom:15px;">REGISTER</h2>
        <input type="text" id="r-name" placeholder="Full Name">
        <input type="tel" id="r-phone" placeholder="WhatsApp Number">
        <input type="email" id="r-email" placeholder="Email Address">
        <input type="password" id="r-pass" placeholder="Password">
        <button class="primary-btn" onclick="register()">Create Account</button>
        <p style="margin-top:15px; font-size:12px; color:#888;">Already have an account? <b onclick="toggleForm('login')" style="color:var(--primary); cursor:pointer;">Login</b></p>
    </div>

    <div id="login-box" class="auth-box hidden">
        <h2 style="color:var(--primary); margin-bottom:15px;">LOGIN</h2>
        <input type="email" id="l-email" placeholder="Email">
        <input type="password" id="l-pass" placeholder="Password">
        <button class="primary-btn" onclick="login()">Login</button>
        <p style="margin-top:15px; font-size:12px; color:#888;">New to ABI Pets? <b onclick="toggleForm('reg')" style="color:var(--primary); cursor:pointer;">Register</b></p>
    </div>
</div>

<div id="main-app" class="hidden">
    <nav style="padding:10px 20px; display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.9); backdrop-filter:blur(10px); position:sticky; top:0; z-index:1000; border-bottom:1px solid var(--glass);">
    
    <div style="display:flex; align-items:center; gap:10px;">
        <img src="logo1.png" alt="Logo" style="width:35px; height:35px; border-radius:50%; object-fit:cover; border:1px solid var(--primary);">
        <span style="font-weight:800; color:var(--primary); font-size:18px; letter-spacing:-0.5px;">ABI FISH & Pets</span>
    </div>

    <div style="display:flex; gap:15px; align-items:center;">
        <i class="fas fa-bell" style="font-size:18px;"></i>
        <i class="fas fa-sign-out-alt" style="font-size:18px;" onclick="firebase.auth().signOut()"></i>
    </div>
</nav>


    <div class="hero">
        <img src="paladrium.jpg" class="hero-img">
        <div class="hero-content">
            <h1>ABI FISH & PETS</h1>
            <p>Premium Quality Pets in Nepal ‚ú®</p>
        </div>
    </div>

    <div class="search-container">
        <div class="search-box">
            <input type="text" id="searchBar" placeholder="Search for pets..." oninput="render()">
            <button><i class="fas fa-search"></i></button>
        </div>
    </div>

    <div class="cat-scroll">
        <div class="cat-chip active" onclick="setCat('All', this)">All</div>
        <div class="cat-chip" onclick="setCat('Fish', this)">Fish</div>
        <div class="cat-chip" onclick="setCat('Bird', this)">Birds</div>
        <div class="cat-chip" onclick="setCat('Dog', this)">Dog</div>
        <div class="cat-chip" onclick="setCat('Product', this)">Product</div>
    </div>

    <div id="priority-sec" class="hidden">
        <div style="padding: 15px 20px 5px; color:var(--primary); font-weight:800; font-size:14px;">‚ö° RECENTLY ADDED</div>
        <div class="swipe-container" id="priorityList"></div>
    </div>

    <div style="padding: 15px 20px 5px; color:#888; font-weight:800; font-size:14px;">EXPLORE ALL</div>
    <div class="grid" id="mainGrid"></div>

    <footer>
        <h2 style="color:var(--primary);">ABI FISH & PETS</h2>
        <p style="font-size:13px; margin: 10px 0;"> Contact: 9703710719</p>
        <div style="display:flex; justify-content:center; gap:20px; font-size:24px; margin: 15px 0;">
            <a href="https://wa.me/9779703710719" style="color:var(--primary);"><i class="fab fa-whatsapp"></i></a>
            <i class="fab fa-facebook"></i>
            <i class="fab fa-instagram"></i>
        </div>
        <p style="color:#444; font-size:11px;">&copy; 2021 Kathamdu,Nepal.Thankyou for choosing us.üôèüíê</p>
    </footer>

    <button class="fab" onclick="document.getElementById('postModal').style.display='flex'"><i class="fas fa-plus"></i></button>
</div>

<div id="postModal" class="modal">
    <div style="background:#111; padding:25px; border-radius:25px; width:100%; max-width:380px;">
        <h3 style="margin-bottom:15px; color:var(--primary);">Post New Pet</h3>
        <select id="pCat" style="width:100%; padding:12px; margin-bottom:10px; background:#1a1a1a; color:#fff; border-radius:10px; border:1px solid #333;">
            <option value="Fish">Fish</option><option value="Bird">Bird</option><option value="Dog">Dog</option><option value="Product">Product</option>
        </select>
        <input type="text" id="pTitle" placeholder="Item Name">
        <input type="number" id="pPrice" placeholder="Price (Rs)">
        <textarea id="pDesc" placeholder="Description..." style="width:100%; height:70px; padding:12px; background:#1a1a1a; color:#fff; border-radius:10px; border:1px solid #333; margin-bottom:10px;"></textarea>
        <input type="file" onchange="encodeImg(this)" style="margin-bottom:15px;">
        <button class="primary-btn" onclick="savePost()">Publish Now</button>
        <button onclick="document.getElementById('postModal').style.display='none'" style="width:100%; background:none; border:none; color:#888; margin-top:10px;">Cancel</button>
    </div>
</div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyAgrXYL1M-cO8LYTmJeEtfwhkp-ghXfNWY",
        authDomain: "abi-fish-pets.firebaseapp.com",
        databaseURL: "https://abi-fish-pets-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "abi-fish-pets",
        storageBucket: "abi-fish-pets.firebasestorage.app",
        messagingSenderId: "644115504257",
        appId: "1:644115504257:web:795f68bba9d68a6e8a0180"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let items = [], users = {}, currentCat = "All", imgData = "";

    // IMPORTANT: Afno Admin Email yaha halnuhos
    const ADMIN_EMAIL = "admin@abipets.com"; 

    // AUTH FUNCTIONS
    function toggleForm(type) {
        document.getElementById('reg-box').classList.toggle('hidden', type === 'login');
        document.getElementById('login-box').classList.toggle('hidden', type === 'reg');
    }

    function register() {
        const e = document.getElementById('r-email').value, p = document.getElementById('r-pass').value, n = document.getElementById('r-name').value;
        firebase.auth().createUserWithEmailAndPassword(e, p).then(res => {
            db.ref('users/' + res.user.uid).set({ name: n, phone: document.getElementById('r-phone').value });
        }).catch(err => alert(err.message));
    }

    function login() {
        const e = document.getElementById('l-email').value, p = document.getElementById('l-pass').value;
        firebase.auth().signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
    }

    firebase.auth().onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            db.ref('users').on('value', s => { users = s.val() || {}; });
            db.ref('listings').on('value', s => {
                items = []; s.forEach(d => { items.push({id: d.key, ...d.val()}); });
                render();
            });
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }
    });

    // RENDER LOGIC
    function setCat(c, el) {
        currentCat = c;
        document.querySelectorAll('.cat-chip').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        render();
    }

    function render() {
        const query = document.getElementById('searchBar').value.toLowerCase();
        const pList = document.getElementById('priorityList'), mGrid = document.getElementById('mainGrid');
        pList.innerHTML = ""; mGrid.innerHTML = "";
        
        const currentUser = firebase.auth().currentUser;
        const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
        let pCount = 0; const now = Date.now();

        items.sort((a,b) => b.time - a.time).forEach(i => {
            if (!i.title.toLowerCase().includes(query)) return;
            
            const isOwner = i.owner === currentUser.uid;
            const sellerName = users[i.owner] ? users[i.owner].name : "ABI Seller";
            const isNew = (now - i.time) < 86400000; // 24 hours check

            // --- PRIORITY SLIDER LOGIC ---
            if (isNew && currentCat === 'All') {
                pList.innerHTML += `
                    <div class="slide-card" style="min-width:200px; flex-shrink:0; background:#1a1a1a; border-radius:15px; overflow:hidden; border:1px solid var(--primary);">
                        <img src="${i.img}" style="width:100%; height:110px; object-fit:cover;">
                        <div style="padding:10px;">
                            <div style="color:var(--primary); font-weight:800; font-size:12px;">Rs. ${i.price}</div>
                            <div style="font-size:11px; margin-bottom:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${i.title}</div>
                            <button onclick="buyNow('${i.title}')" style="width:100%; padding:6px; background:var(--primary); border:none; border-radius:8px; font-weight:800; font-size:10px;">BUY NOW</button>
                        </div>
                    </div>`;
                pCount++;
            }

            // --- MAIN GRID LOGIC WITH ROLES ---
            if (currentCat === 'All' || i.cat === currentCat) {
                let actionButtons = "";

                if (isAdmin) {
                    // ADMIN: Full Control
                    actionButtons = `
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:10px;">
                            <button onclick="editItem('${i.id}')" style="background:#444; color:#fff; border:none; padding:8px; border-radius:8px; font-weight:800; font-size:11px;">Edit</button>
                            <button onclick="deleteItem('${i.id}')" style="background:#ff4444; color:#fff; border:none; padding:8px; border-radius:8px; font-weight:800; font-size:11px;">Delete</button>
                        </div>
                        <button onclick="buyNow('${i.title}')" class="primary-btn" style="margin-top:5px; padding:8px;">Buy Now</button>
                    `;
                } else if (isOwner) {
                    // SELLER: Only Edit/Delete
                    actionButtons = `
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:10px;">
                            <button onclick="editItem('${i.id}')" style="background:#444; color:#fff; border:none; padding:8px; border-radius:8px; font-weight:800; font-size:11px;">Edit</button>
                            <button onclick="deleteItem('${i.id}')" style="background:#ff4444; color:#fff; border:none; padding:8px; border-radius:8px; font-weight:800; font-size:11px;">Delete</button>
                        </div>
                    `;
                } else {
                    // CLIENT: Buy & Report
                    actionButtons = `
                        <button onclick="buyNow('${i.title}')" class="primary-btn" style="margin-top:10px; padding:10px;">Buy Now</button>
                        <button onclick="reportItem('${i.id}')" style="background:none; border:none; color:#ff4444; font-size:10px; margin-top:8px; width:100%; cursor:pointer;">Report Content</button>
                    `;
                }

                mGrid.innerHTML += `
                    <div class="item-card">
                        <div style="position:relative;">
                            <img src="${i.img}" class="item-img">
                            <div class="price-tag">Rs. ${i.price}</div>
                        </div>
                        <div style="padding:12px;">
                            <div style="font-weight:700; font-size:14px;">${i.title}</div>
                            <div style="font-size:11px; color:#888; margin: 4px 0; height:30px; overflow:hidden;">${i.desc || ''}</div>
                            <div style="font-size:10px; color:var(--primary);"><i class="fas fa-user"></i> ${sellerName}</div>
                            ${actionButtons}
                        </div>
                    </div>`;
            }
        });
        
        // Priority section hide/show
        document.getElementById('priority-sec').classList.toggle('hidden', pCount === 0 || currentCat !== 'All');
    }

    // ACTION FUNCTIONS
    function buyNow(name) {
        window.open(`https://wa.me/9779703710719?text=Interested in: ${name}`);
    }

    function deleteItem(id) {
        if(confirm("Are you sure you want to delete this item?")) {
            db.ref('listings/' + id).remove().then(() => alert("Deleted successfully!"));
        }
    }

    function editItem(id) {
        const item = items.find(x => x.id === id);
        const newPrice = prompt("Update Price for " + item.title + ":", item.price);
        const newDesc = prompt("Update Description:", item.desc || "");
        if(newPrice !== null) {
            db.ref('listings/' + id).update({ price: newPrice, desc: newDesc });
        }
    }

    function reportItem(id) {
        alert("Reported! Admin will review item ID: " + id);
    }

    function encodeImg(el) {
        const reader = new FileReader();
        reader.onload = () => imgData = reader.result;
        reader.readAsDataURL(el.files[0]);
    }

    function savePost() {
        const title = document.getElementById('pTitle').value, price = document.getElementById('pPrice').value;
        const cat = document.getElementById('pCat').value, desc = document.getElementById('pDesc').value;
        if(!imgData || !title || !price) return alert("Please fill all fields!");
        
        db.ref('listings').push().set({ 
            title, price, cat, desc, img: imgData, 
            time: Date.now(), 
            owner: firebase.auth().currentUser.uid 
        })
        .then(() => { 
            document.getElementById('postModal').style.display='none'; 
            imgData = ""; 
            alert("Published successfully!");
        });
    }
</script>

</body>
    </html>
        
